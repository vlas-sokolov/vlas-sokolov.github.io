<!DOCTYPE html>
<html lang="en" itemscope itemtype="http://schema.org/WebPage">
  <head>
    

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

  <title>Urban Growth - Vlas Sokolov</title>
  <meta name="description" content="Projected urban growth (2018-2035) While taking a much needed break from thesis writing, I was toying around with map visualizations in Python. After all, plotting maps of the land has got to be similar to making maps of the sky, right? All in all, plotting geospatial data turned out to be a rather easy, and I spent most time looking for a decent data to plot and on a formidable task of choosing which map projection to use.">
  <meta name="author" content="Vlas Sokolov"/><script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "WebSite",
    "name": "Vlas Sokolov",
    
    "url": "https:\/\/vlas.dev"
}
</script><script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Organization",
  "name": "",
  "url": "https:\/\/vlas.dev"
  
  
  
  
}
</script>
<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [{
        "@type": "ListItem",
        "position": 1,
        "item": {
          "@id": "https:\/\/vlas.dev",
          "name": "home"
        }
    },{
        "@type": "ListItem",
        "position": 3,
        "item": {
          "@id": "https:\/\/vlas.dev\/post\/urban-growth\/",
          "name": "Urban growth"
        }
    }]
}
</script><script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Article",
  "author": {
    "name" : "Vlas Sokolov"
  },
  "headline": "Urban Growth",
  "description" : "Projected urban growth (2018-2035) While taking a much needed break from thesis writing, I was toying around with map visualizations in Python. After all, plotting maps of the land has got to be similar to making maps of the sky, right? All in all, plotting geospatial data turned out to be a rather easy, and I spent most time looking for a decent data to plot and on a formidable task of choosing which map projection to use.",
  "inLanguage" : "en",
  "wordCount":  1305 ,
  "datePublished" : "2018-08-20T15:27:23",
  "dateModified" : "2018-08-20T15:27:23",
  "image" : "https:\/\/vlas.dev\/img\/iram30m.jpg",
  "keywords" : [ "" ],
  "mainEntityOfPage" : "https:\/\/vlas.dev\/post\/urban-growth\/",
  "publisher" : {
    "@type": "Organization",
    "name" : "https:\/\/vlas.dev",
    "logo" : {
        "@type" : "ImageObject",
        "url" : "https:\/\/vlas.dev\/img\/iram30m.jpg",
        "height" :  60 ,
        "width" :  60
    }
  }
}
</script>

<meta property="og:title" content="Urban Growth" />
<meta property="og:description" content="Projected urban growth (2018-2035) While taking a much needed break from thesis writing, I was toying around with map visualizations in Python. After all, plotting maps of the land has got to be similar to making maps of the sky, right? All in all, plotting geospatial data turned out to be a rather easy, and I spent most time looking for a decent data to plot and on a formidable task of choosing which map projection to use.">
<meta property="og:image" content="https://vlas.dev/img/iram30m.jpg" />
<meta property="og:url" content="https://vlas.dev/post/urban-growth/" />
<meta property="og:type" content="website" />
<meta property="og:site_name" content="Vlas Sokolov" />

  <meta name="twitter:title" content="Urban Growth" />
  <meta name="twitter:description" content="Projected urban growth (2018-2035) While taking a much needed break from thesis writing, I was toying around with map visualizations in Python. After all, plotting maps of the land has got to be â€¦">
  <meta name="twitter:image" content="https://vlas.dev/img/iram30m.jpg" />
  <meta name="twitter:card" content="summary" />
  <link href='https://vlas.dev/img/favicon.ico' rel='icon' type='image/x-icon'/>
  <meta name="generator" content="Hugo 0.75.1" />
  <link rel="alternate" href="https://vlas.dev/index.xml" type="application/rss+xml" title="Vlas Sokolov"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css" integrity="sha384-9eLZqc9ds8eNjO3TmqPeYcDj8n+Qfa4nuSiGYa6DjLNcv9BtN69ZIulL9+8CqC9Y" crossorigin="anonymous">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css" integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU" crossorigin="anonymous">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous"><link rel="stylesheet" href="https://vlas.dev/css/main.css" /><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" />
  <link rel="stylesheet" href="https://vlas.dev/css/highlight.min.css" /><link rel="stylesheet" href="https://vlas.dev/css/codeblock.css" /><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.css" integrity="sha384-h/L2W9KefUClHWaty3SLE5F/qvc4djlyR4qY3NUV5HGQBBW7stbcfff1+I/vmsHh" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/default-skin/default-skin.min.css" integrity="sha384-iD0dNku6PYSIQLyfTOpB06F2KCZJAKLOThS5HRe8b3ibhdEQ6eKsFf/EeFxdOt5R" crossorigin="anonymous">



  </head>
  <body>
    <nav class="navbar navbar-default navbar-fixed-top navbar-custom">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#main-navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="https://vlas.dev">Vlas Sokolov</a>
    </div>

    <div class="collapse navbar-collapse" id="main-navbar">
      <ul class="nav navbar-nav navbar-right">
        
          
            <li>
              <a title="About" href="../../page/about/">About</a>
            </li>
          
        
          
            <li>
              <a title="Blog" href="../../">Blog</a>
            </li>
          
        
          
            <li>
              <a title="CV (pdf)" href="../../pdfs/cv.pdf">CV (pdf)</a>
            </li>
          
        

        

        
      </ul>
    </div>

    
      <div class="avatar-container">
        <div class="avatar-img-border">
          <a title="Vlas Sokolov" href="https://vlas.dev">
            <img class="avatar-img" src="https://vlas.dev/img/iram30m.jpg" alt="Vlas Sokolov" />
          </a>
        </div>
      </div>
    

  </div>
</nav>




    


<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

<div class="pswp__bg"></div>

<div class="pswp__scroll-wrap">
    
    <div class="pswp__container">
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
    </div>
    
    <div class="pswp__ui pswp__ui--hidden">
    <div class="pswp__top-bar">
      
      <div class="pswp__counter"></div>
      <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
      <button class="pswp__button pswp__button--share" title="Share"></button>
      <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
      <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
      
      
      <div class="pswp__preloader">
        <div class="pswp__preloader__icn">
          <div class="pswp__preloader__cut">
            <div class="pswp__preloader__donut"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
      <div class="pswp__share-tooltip"></div>
    </div>
    <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
    </button>
    <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
    </button>
    <div class="pswp__caption">
      <div class="pswp__caption__center"></div>
    </div>
    </div>
    </div>
</div>


  
  
  






  

  <header class="header-section ">
    
    <div class="intro-header no-img">
      <div class="container">
        <div class="row">
          <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
            <div class="post-heading">
              
                <h1>Urban Growth</h1>
              
              
              
              
                <span class="post-meta">
  
  
  <i class="fas fa-calendar"></i>&nbsp;Posted on August 20, 2018
  
  
  
  
    
      &nbsp;|&nbsp;<i class="fas fa-user"></i>&nbsp;Vlas Sokolov
    
  
  
</span>


              
            </div>
          </div>
        </div>
      </div>
    </div>
  </header>


    
<div class="container" role="main">
  <div class="row">
    <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
      <article role="main" class="blog-post">
        <h2 id="projected-urban-growth-2018-2035">Projected urban growth (2018-2035)</h2>
<p>While taking a much needed break from thesis writing, I was toying around with map visualizations in Python.
After all, plotting maps of the land has got to be similar to making maps of the sky, right?
All in all, plotting geospatial data turned out to be a rather easy, and I spent most time looking for a decent data to plot and on a formidable task of <a href="https://xkcd.com/977/">choosing which map projection to use</a>.</p>
<p>Search on publicly available datasets eventually landed me on UN <a href="https://esa.un.org/unpd/wup/">World Urbanization Prospects</a> page, with their 2018 report containing estimates for populations of urban areas with &gt;300,000 population, as well as their projected yearly populations all the way until 2035! So what can you you tell from a population dynamics of cities over decades?</p>
<p>It seems that globally, you&rsquo;d expect two effects coming into play simultaneously: the overall <em>population change</em> of a given country, as well as the <em>urbanization pace</em> within it. Just from those two, we can predict some trends in the dataset already, though I&rsquo;m clearly cheating in pretending that I haven&rsquo;t looked at the data already:</p>
<ul>
<li>Large population increases in countries like India and China will unavoidably lead to increase in city populations. On the other hand, population decline of Japan will definitely show up in the population dynamics visualized.</li>
<li>While much of the Western world already heavily urbanized, many countries still maintain large rural populations. According to the UN report, Africa and Asia are home to nearly 90% of the world&rsquo;s rural population. The UN report <a href="https://esa.un.org/unpd/wup/General/FAQs.aspx">assumes</a> that the urban/rural ratio development will follow the overall world trend, and we expect to see a large fractional change in urban population in <a href="https://en.wikipedia.org/wiki/Urbanization#/media/File:2015_World_Urbanization_Map.png">relatively rural</a> countries.</li>
</ul>
<p>So let&rsquo;s see where the cities will grow most/least! Two Python plotting frameworks are to be explored:</p>
<ol>
<li>Riding on top of heavily-customizable behemoth of scientific plotting, <a href="https://matplotlib.org/">matplotlib</a>, the map-making <a href="https://matplotlib.org/basemap/">basemap</a> package.</li>
<li><a href="https://d3js.org/">D3.js</a>-based <a href="https://plot.ly/">plot.ly</a> framework is a modern web-driven visualization tool, with a whole bunch of high-level plotting routine. Its lower-level customization is limited due to my near-illiteracy in javascript, so we&rsquo;re going to use Python implementation of plotly.</li>
</ol>
<h3 id="obtaining-the-data">Obtaining the data</h3>
<p>The Excel file can be downloaded <a href="https://esa.un.org/unpd/wup/Download/Files/WUP2018-F22-Cities_Over_300K_Annual.xls">here</a>. I used LibreOffice to convert it to a .csv file that&rsquo;s included in the GitHub <a href="https://github.com/vlas-sokolov/urban-growth/">repo</a>, where the code snippets come from.</p>
<p><em>Data source: United Nations, Department of Economic and Social Affairs, Population Division (2018). World Urbanization Prospects: The 2018 Revision, Online Edition.</em></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> pandas <span style="color:#f92672">as</span> pd

fname<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;data/WUP2018-F22-Cities_Over_300K_Annual.csv&#34;</span>
df <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>read_csv(fname, thousands<span style="color:#f92672">=</span><span style="color:#e6db74">&#34; &#34;</span>, skiprows<span style="color:#f92672">=</span><span style="color:#ae81ff">16</span>, index_col<span style="color:#f92672">=</span><span style="color:#ae81ff">4</span>)

<span style="color:#75715e"># adding some basics on the UN-projected city growth, 2018-2035</span>
df[<span style="color:#e6db74">&#34;growthabs&#34;</span>] <span style="color:#f92672">=</span> df[<span style="color:#e6db74">&#34;2035&#34;</span>] <span style="color:#f92672">-</span> df[<span style="color:#e6db74">&#34;2018&#34;</span>]
df[<span style="color:#e6db74">&#34;growthperc&#34;</span>] <span style="color:#f92672">=</span> df[<span style="color:#e6db74">&#34;growthabs&#34;</span>] <span style="color:#f92672">/</span> df[<span style="color:#e6db74">&#34;2018&#34;</span>] <span style="color:#f92672">*</span> <span style="color:#ae81ff">100</span>
</code></pre></div><p>With the data loaded, let&rsquo;s think on what we want to show to begin with. Two quantities are of interest: the <em>absolute</em> population change and the <em>fractional</em> one. The cities that show the most total population change are not necessarily the same cities that show the biggest percentage growth!</p>
<p>A <a href="https://github.com/vlas-sokolov/urban-growth/blob/master/wup2018.ipynb">quick look</a> shows that the top 5 fractional growth is projected to occur in rapidly-growing African cities. In fact, 94 out of 100 fastest-growing cities are in Africa! This means that urbanization alone can not explain the population increase in urban areas, but is coupled with the overall population growth. The reason behind the latter is that Africa&rsquo;s population is young and is expected to <a href="https://www.theguardian.com/global-development-professionals-network/2016/jan/11/population-growth-in-africa-grasping-the-scale-of-the-challenge">double by 2050</a>, driven by access to better healthcare (meaning higher life expectancy and lower infant mortality rates), while the <a href="https://en.wikipedia.org/wiki/Total_fertility_rate">total fertility rates</a> remain high.</p>
<p>In any case, let&rsquo;s get back to plotting! For each city, a marking on the map is to be made. We&rsquo;ll use the absolute population change as a size of it, and a fractional change will be shown in color.</p>
<h3 id="plotting-with-matplotlib">Plotting with matplotlib</h3>
<p>The high level of customization possible in <code>matplotlib</code> allows to do whatever we want with the colors of the markers. We&rsquo;ll make a custom colormap for the job, with red representing population decline, green for the growth, and yellow for the zero change midpoint.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">from</span> matplotlib.colors <span style="color:#f92672">import</span> Normalize
<span style="color:#f92672">import</span> numpy <span style="color:#f92672">as</span> np

<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">MidpointNormalize</span>(Normalize):
    <span style="color:#e6db74">&#34;&#34;&#34; 
</span><span style="color:#e6db74">    Used to force a zero level in a colormap.
</span><span style="color:#e6db74">    Neat for forcing reds to negative urban growth.
</span><span style="color:#e6db74">
</span><span style="color:#e6db74">    Taken from Joe Kington&#39;s answer on StackOverflow:
</span><span style="color:#e6db74">    https://stackoverflow.com/a/20146989/4118756
</span><span style="color:#e6db74">    &#34;&#34;&#34;</span>
    <span style="color:#66d9ef">def</span> __init__(self, vmin<span style="color:#f92672">=</span>None, vmax<span style="color:#f92672">=</span>None, midpoint<span style="color:#f92672">=</span>None, clip<span style="color:#f92672">=</span>False):
        self<span style="color:#f92672">.</span>midpoint <span style="color:#f92672">=</span> midpoint
        Normalize<span style="color:#f92672">.</span>__init__(self, vmin, vmax, clip)

    <span style="color:#66d9ef">def</span> __call__(self, value, clip<span style="color:#f92672">=</span>None):
        <span style="color:#75715e"># I&#39;m ignoring masked values and all kinds of edge cases to make a</span>
        <span style="color:#75715e"># simple example...</span>
        x, y <span style="color:#f92672">=</span> [self<span style="color:#f92672">.</span>vmin, self<span style="color:#f92672">.</span>midpoint, self<span style="color:#f92672">.</span>vmax], [<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0.5</span>, <span style="color:#ae81ff">1</span>]
        <span style="color:#66d9ef">return</span> np<span style="color:#f92672">.</span>ma<span style="color:#f92672">.</span>masked_array(np<span style="color:#f92672">.</span>interp(value, x, y))
</code></pre></div><p>Now for the actual plotting, the <code>basemap</code> will handle all the map projections, while the scatter plot, colorings, legend and colorbar are handed over to <code>matplotlib</code>. Had to tinker a bit with the color ranges and sizes of the points (power-scaling makes better visual contrast and an absolute offset allows small changes to still be seen).</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">%</span> matplotlib inline
<span style="color:#f92672">import</span> matplotlib.pyplot <span style="color:#f92672">as</span> plt
<span style="color:#f92672">from</span> mpl_toolkits.basemap <span style="color:#f92672">import</span> Basemap

plt<span style="color:#f92672">.</span>rc(<span style="color:#e6db74">&#39;text&#39;</span>, usetex<span style="color:#f92672">=</span>True)

<span style="color:#75715e"># scale markers by absolute growth</span>
growth_to_msize <span style="color:#f92672">=</span> <span style="color:#66d9ef">lambda</span> p: np<span style="color:#f92672">.</span>abs(p)<span style="color:#f92672">**</span><span style="color:#ae81ff">0.7</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">10</span>
m_size <span style="color:#f92672">=</span> df[<span style="color:#e6db74">&#39;growthabs&#39;</span>]<span style="color:#f92672">.</span>apply(growth_to_msize)

<span style="color:#75715e"># color markers by relative growth</span>
m_col <span style="color:#f92672">=</span> df[<span style="color:#e6db74">&#39;growthperc&#39;</span>]
vmin, vmax <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>percentile(m_col, <span style="color:#ae81ff">1</span>), np<span style="color:#f92672">.</span>percentile(m_col, <span style="color:#ae81ff">95</span>)
normalize <span style="color:#f92672">=</span> MidpointNormalize(vmin<span style="color:#f92672">=</span>vmin, vmax<span style="color:#f92672">=</span>vmax, midpoint<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>)

<span style="color:#75715e"># Basemap takes plt.gcf() as a figure but doesn&#39;t pass kwargs to figures</span>
plt<span style="color:#f92672">.</span>figure(figsize<span style="color:#f92672">=</span>(<span style="color:#ae81ff">16</span>, <span style="color:#ae81ff">8</span>))
<span style="color:#75715e"># we don&#39;t want xkcd to infer our personality type, hence the</span>
<span style="color:#75715e"># choice of the McBryde-Thomas Flat Polar Quartic projection</span>
bmap <span style="color:#f92672">=</span> Basemap(resolution<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;l&#39;</span>, projection<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;mbtfpq&#39;</span>, lon_0<span style="color:#f92672">=</span><span style="color:#ae81ff">45</span>, lat_0<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>)
bmap<span style="color:#f92672">.</span>drawmapboundary(fill_color<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;#c6dbef&#39;</span>)
bmap<span style="color:#f92672">.</span>fillcontinents(color<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;#f2e0c9&#39;</span>, lake_color<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;#c6dbef&#39;</span>,
                    zorder<span style="color:#f92672">=</span><span style="color:#ae81ff">0.8</span>, alpha<span style="color:#f92672">=</span><span style="color:#ae81ff">0.5</span>)
bmap<span style="color:#f92672">.</span>etopo(alpha<span style="color:#f92672">=</span><span style="color:#ae81ff">0.3</span>, zorder<span style="color:#f92672">=</span><span style="color:#ae81ff">0.9</span>)
bmap<span style="color:#f92672">.</span>drawcoastlines(linewidth<span style="color:#f92672">=</span><span style="color:#ae81ff">0.6</span>, zorder<span style="color:#f92672">=</span><span style="color:#ae81ff">0.9</span>, color<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;#525252&#39;</span>)
bmap<span style="color:#f92672">.</span>drawcountries(linewidth<span style="color:#f92672">=</span><span style="color:#ae81ff">0.6</span>, zorder<span style="color:#f92672">=</span><span style="color:#ae81ff">0.9</span>, color<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;#525252&#39;</span>)
x, y <span style="color:#f92672">=</span> bmap(df[<span style="color:#e6db74">&#39;Longitude&#39;</span>]<span style="color:#f92672">.</span>values, df[<span style="color:#e6db74">&#39;Latitude&#39;</span>]<span style="color:#f92672">.</span>values)
bmap<span style="color:#f92672">.</span>scatter(x, y, c<span style="color:#f92672">=</span>m_col,
            s<span style="color:#f92672">=</span>m_size, marker<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;.&#39;</span>, alpha<span style="color:#f92672">=</span><span style="color:#ae81ff">0.9</span>, edgecolor<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;#737373&#39;</span>,
            cmap<span style="color:#f92672">=</span>plt<span style="color:#f92672">.</span>cm<span style="color:#f92672">.</span>RdYlGn, norm<span style="color:#f92672">=</span>normalize, zorder<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>)
cbar <span style="color:#f92672">=</span> bmap<span style="color:#f92672">.</span>colorbar(size<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;2%&#39;</span>, extend<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;max&#39;</span>)
cbar<span style="color:#f92672">.</span>set_label(<span style="color:#e6db74">r</span><span style="color:#e6db74">&#39;$\mathrm{Relative~city~size~growth~(\%)}$&#39;</span>,
               fontsize<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;large&#39;</span>)
plt<span style="color:#f92672">.</span>gca()<span style="color:#f92672">.</span>set_title(<span style="color:#e6db74">r</span><span style="color:#e6db74">&#39;$\mathrm{Projected~growth~of~cities~with~over&#39;</span>
              <span style="color:#e6db74">&#39;~300\,000~inhabitants~(2018-2035)}$&#39;</span>, fontsize<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;x-large&#39;</span>)

bmap<span style="color:#f92672">.</span>drawparallels(np<span style="color:#f92672">.</span>arange(<span style="color:#f92672">-</span><span style="color:#ae81ff">90.</span>,<span style="color:#ae81ff">120.</span>,<span style="color:#ae81ff">30.</span>), zorder<span style="color:#f92672">=</span><span style="color:#ae81ff">0.7</span>,
                   color<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;#969696&#39;</span>, linewidth<span style="color:#f92672">=</span><span style="color:#ae81ff">0.3</span>)
bmap<span style="color:#f92672">.</span>drawmeridians(np<span style="color:#f92672">.</span>arange(<span style="color:#ae81ff">0.</span>,<span style="color:#ae81ff">360.</span>,<span style="color:#ae81ff">60.</span>), zorder<span style="color:#f92672">=</span><span style="color:#ae81ff">0.7</span>,
                   color<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;#969696&#39;</span>, linewidth<span style="color:#f92672">=</span><span style="color:#ae81ff">0.3</span>)

<span style="color:#75715e"># display size scale of the scatter points</span>
<span style="color:#66d9ef">for</span> dp, lab <span style="color:#f92672">in</span> zip([<span style="color:#ae81ff">10</span>, <span style="color:#ae81ff">100</span>, <span style="color:#ae81ff">1000</span>, <span style="color:#ae81ff">10000</span>],
        [<span style="color:#e6db74">r</span><span style="color:#e6db74">&#39;$10\,000$&#39;</span>, <span style="color:#e6db74">r</span><span style="color:#e6db74">&#39;$100\,000$&#39;</span>,
         <span style="color:#e6db74">r</span><span style="color:#e6db74">&#39;$1~\mathrm{million}$&#39;</span>, <span style="color:#e6db74">r</span><span style="color:#e6db74">&#39;$10~\mathrm{million}$&#39;</span>]):
    plt<span style="color:#f92672">.</span>scatter([], [], facecolor<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;none&#39;</span>, edgecolor<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;#737373&#39;</span>, alpha<span style="color:#f92672">=</span><span style="color:#ae81ff">0.9</span>,
                s<span style="color:#f92672">=</span>growth_to_msize(dp), marker<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;.&#39;</span>, label<span style="color:#f92672">=</span>lab)
plt<span style="color:#f92672">.</span>legend(scatterpoints<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>, frameon<span style="color:#f92672">=</span>False, labelspacing<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>, loc<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;lower left&#39;</span>)

<span style="color:#75715e"># basemap issue:</span>
<span style="color:#75715e"># https://stackoverflow.com/questions/15003353</span>
cbar<span style="color:#f92672">.</span>set_alpha(<span style="color:#ae81ff">1</span>)
cbar<span style="color:#f92672">.</span>draw_all()

plt<span style="color:#f92672">.</span>show()
</code></pre></div><p><img src="wup-urban-growth.png" alt="Urban growth with matplotlib"></p>
<p>And there we have it, as pretty as I could get it to be! The only downsides is that it&rsquo;s noninteractive and takes a bit of time to generate. So let&rsquo;s see how web-based approach works!</p>
<h3 id="plotting-with-plotly">Plotting with plotly</h3>
<p>Everything related to the individual data points is defined below:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">growth_to_msize <span style="color:#f92672">=</span> <span style="color:#66d9ef">lambda</span> p: np<span style="color:#f92672">.</span>abs(p)<span style="color:#f92672">**</span><span style="color:#ae81ff">0.5</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">3</span>
m_col <span style="color:#f92672">=</span> df[<span style="color:#e6db74">&#39;growthperc&#39;</span>]
cmin, cmax <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>percentile(m_col, <span style="color:#ae81ff">1</span>), np<span style="color:#f92672">.</span>percentile(m_col, <span style="color:#ae81ff">95</span>)

df[<span style="color:#e6db74">&#39;growth_abs_str&#39;</span>] <span style="color:#f92672">=</span> df<span style="color:#f92672">.</span>growthabs<span style="color:#f92672">.</span>apply(<span style="color:#66d9ef">lambda</span> n: f<span style="color:#e6db74">&#39;{n*1000:+,d}&#39;</span>)
df[<span style="color:#e6db74">&#39;growth_perc_str&#39;</span>] <span style="color:#f92672">=</span> df<span style="color:#f92672">.</span>growthperc<span style="color:#f92672">.</span>apply(<span style="color:#66d9ef">lambda</span> p: f<span style="color:#e6db74">&#39;{p:+.1f}%&#39;</span>)
<span style="color:#75715e"># using hiddent atttributes is bad and I should feed bad</span>
df[<span style="color:#e6db74">&#39;growth_str&#39;</span>] <span style="color:#f92672">=</span> df[[<span style="color:#e6db74">&#39;growth_abs_str&#39;</span>, <span style="color:#e6db74">&#39;growth_perc_str&#39;</span>]]<span style="color:#f92672">.</span>apply(
            <span style="color:#66d9ef">lambda</span> x: f<span style="color:#e6db74">&#39;{x._name}: {x[0]} ({x[1]})&#39;</span>, axis<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>)

urban_growth <span style="color:#f92672">=</span> [dict(
        name <span style="color:#f92672">=</span> df<span style="color:#f92672">.</span>index<span style="color:#f92672">.</span>values,
        lon <span style="color:#f92672">=</span> df[<span style="color:#e6db74">&#39;Longitude&#39;</span>],
        lat <span style="color:#f92672">=</span> df[<span style="color:#e6db74">&#39;Latitude&#39;</span>],
        marker <span style="color:#f92672">=</span> dict(
            color <span style="color:#f92672">=</span> df[<span style="color:#e6db74">&#39;growthperc&#39;</span>], <span style="color:#75715e"># color by fractional increase</span>
            colorscale <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;Portland&#39;</span>, <span style="color:#75715e"># palette name</span>
            colorbar <span style="color:#f92672">=</span> {<span style="color:#e6db74">&#39;ticksuffix&#39;</span>: <span style="color:#e6db74">&#39;%&#39;</span>},
            reversescale <span style="color:#f92672">=</span> True, <span style="color:#75715e"># invert the colorbar mapping</span>
            showscale <span style="color:#f92672">=</span> True, <span style="color:#75715e"># show colorbar?</span>
            cmin <span style="color:#f92672">=</span> cmin,
            cmax <span style="color:#f92672">=</span> cmax,
            sizemode <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;area&#39;</span>, <span style="color:#75715e"># could play with power scale instead</span>
            size <span style="color:#f92672">=</span> growth_to_msize(df[<span style="color:#e6db74">&#39;growthabs&#39;</span>])
            ),
        type <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;scattergeo&#39;</span>,
        showlegend <span style="color:#f92672">=</span> False,
        text <span style="color:#f92672">=</span> df[<span style="color:#e6db74">&#39;growth_str&#39;</span>],
        hoverinfo <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;text&#39;</span>
    )]
</code></pre></div><p>&hellip; and all the settings for a more global layout are described here:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">layout <span style="color:#f92672">=</span> dict(
    title <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;Projected growth of cities with over&#39;</span>
             <span style="color:#e6db74">&#39; 300,000 inhabitants (2018-2035)&#39;</span>
             <span style="color:#e6db74">&#39;&lt;br&gt;Source: &lt;a href=&#34;https://esa.un.org/unpd/wup/&#34;&gt;&#39;</span>
             <span style="color:#e6db74">&#39; UN World Urbanization Prospects 2018&lt;/a&gt;&#39;</span>,
    showlegend <span style="color:#f92672">=</span> True,
    geo <span style="color:#f92672">=</span> dict(
        scope <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;world&#39;</span>,
        projection <span style="color:#f92672">=</span> dict(type<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;orthographic&#39;</span>),
        showland <span style="color:#f92672">=</span> True,
        showcoastlines <span style="color:#f92672">=</span> True,
        resolution <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;110&#39;</span>, <span style="color:#75715e"># the only other available option is too slow!</span>
        showcountries <span style="color:#f92672">=</span> True,
        countrycolor <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;#525252&#39;</span>,
        showocean <span style="color:#f92672">=</span> True,
        oceancolor <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;#c6dbef&#39;</span>,
        showlakes <span style="color:#f92672">=</span> True,
        lakecolor <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;#c6dbef&#39;</span>,
        showrivers <span style="color:#f92672">=</span> True,
        rivercolor <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;#c6dbef&#39;</span>,
        landcolor <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;#f2e0c9&#39;</span>,
        subunitwidth <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>,
        countrywidth <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>,
        <span style="color:#75715e">#subunitcolor = &#34;rgb(255, 255, 255)&#34;, # que es?</span>
    ))
</code></pre></div><p>With these two, we just have to call one command (<code>iplot(dict(data=urban_growth, layout=layout))</code> in Jupyter notebook) and we have an interactive spinning globe with informative tooltips showing the exact values for each urban area.</p>
<div>
    <iframe width="900" height="800" frameborder="0" scrolling="no" src="//plot.ly/~vlas-sokolov/14.embed"></iframe>
</div>


        

        

        
      </article>

      
        <ul class="pager blog-pager">
          
            <li class="previous">
              <a href="https://vlas.dev/post/gaia-dr2-hrd/" data-toggle="tooltip" data-placement="top" title="Gaia H-R diagrams">&larr; Previous Post</a>
            </li>
          
          
            <li class="next">
              <a href="https://vlas.dev/post/cloudh-ppv/" data-toggle="tooltip" data-placement="top" title="Tangled velocity structure in a massive stellar nursery">Next Post &rarr;</a>
            </li>
          
        </ul>
      


      
        
        
      

    </div>
  </div>
</div>

    <footer>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <ul class="list-inline text-center footer-links">
          
              <li>
                <a href="mailto:vlas.sokolov@mpg-alumni.de" title="Email me">
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x"></i>
                    <i class="fas fa-envelope fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
                <a href="https://www.facebook.com/vlas.sokolov" title="Facebook">
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x"></i>
                    <i class="fab fa-facebook fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
                <a href="https://github.com/vlas-sokolov" title="GitHub">
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x"></i>
                    <i class="fab fa-github fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
                <a href="https://linkedin.com/in/vlas-sokolov" title="LinkedIn">
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x"></i>
                    <i class="fab fa-linkedin fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
                <a href="https://stackoverflow.com/users/4118756/vlas-sokolov" title="StackOverflow">
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x"></i>
                    <i class="fab fa-stack-overflow fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
          
        </ul>
        <p class="credits copyright text-muted">
          
            
              Vlas Sokolov
            
          

          &nbsp;&bull;&nbsp;
          2018

          
            &nbsp;&bull;&nbsp;
            <a href="https://vlas.dev">Vlas Sokolov</a>
          
        </p>
        
        <p class="credits theme-by text-muted">
          [Powered by <a href="https://github.com/halogenica/beautifulhugo">Beautiful Hugo</a>]
          
        </p>
      </div>
    </div>
  </div>
</footer><script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.js" integrity="sha384-K3vbOmF2BtaVai+Qk37uypf7VrgBubhQreNQe9aGsz9lB63dIFiQVlJbr92dw2Lx" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/contrib/auto-render.min.js" integrity="sha384-kmZOZB5ObwgQnS/DuDg6TScgOiWWBiVt0plIRkZCmE6rDZGrEOQeHM5PcHi+nyqe" crossorigin="anonymous"></script>
<script src="https://code.jquery.com/jquery-1.12.4.min.js" integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<script src="https://vlas.dev/js/main.js"></script>
<script src="https://vlas.dev/js/highlight.min.js"></script>
<script> hljs.initHighlightingOnLoad(); </script>
<script> $(document).ready(function() {$("pre.chroma").css("padding","0");}); </script><script> renderMathInElement(document.body); </script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.js" integrity="sha384-QELNnmcmU8IR9ZAykt67vGr9/rZJdHbiWi64V88fCPaOohUlHCqUD/unNN0BXSqy" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe-ui-default.min.js" integrity="sha384-m67o7SkQ1ALzKZIFh4CiTA8tmadaujiTa9Vu+nqPSwDOqHrDmxLezTdFln8077+q" crossorigin="anonymous"></script>
<script src="https://vlas.dev/js/load-photoswipe.js"></script>






    
  </body>
</html>

